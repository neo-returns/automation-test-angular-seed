machine:
  pre: 
    - case $CIRCLE_NODE_INDEX in 0) wget https://github.com/coreos/fleet/releases/download/v0.3.2/fleet-v0.3.2-darwin-amd64.zip && unzip fleet-v0.3.2-darwin-amd64.zip; sudo cp fleet-v0.3.2-darwin-amd64/fleetctl /usr/local/bin/;chmod 400 Automation.pem;ssh-add Automation.pem;
  
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"    
  override:
    - docker info
    - if [[ -e ~/docker ]]; then docker load -i ~/docker/image.tar; fi
    - docker build -t neoreturns/automation-test-angular-seed .
    - mkdir -p ~/docker; docker save neoreturns/automation-test-angular-seed > ~/docker/image.tar

test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) docker run -d -p 8000:8000 neoreturns/automation-test-angular-seed; sleep 10; npm test ;; 1) docker run -d -p 8000:8000 neoreturns/automation-test-angular-seed; sleep 10; sh scripts/e2e-test.sh ;; esac:
        parallel: true

  
deployment:     
  hub: 
    branch: master
    commands:
      - docker login -e="ptaylor@medullan.com" -p="Futurtech123" -u="neoreturns"
      - docker push neoreturns/automation-test-angular-seed
  staging:
    branch: master
    heroku:
      appname: automation-test-angular-seed
      
general: 
  artifacts : 
    -  "~/coverage"
    

  
    

    